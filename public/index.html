<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Bsure · Tenant Lookup</title>
<link rel="icon" href="/logo.svg"/>
<link rel="stylesheet" href="/styles.css"/>
</head>
<body>

<header class="nav">
  <div class="nav-inner">
    <img src="/logo.svg" alt="Bsure logo" class="brand-logo"/>
    <div class="brand-title">Tenant lookup</div>
    <div id="me" class="chip" title="Signed-in user">signed in</div>
  </div>
</header>


<main class="wrap">
  <section class="card">
    <h1>Find tenant by Subscription ID</h1>
    <p class="lead">
      Enter a <b>Subscription ID</b>. The tool looks up tenantId, tenantName and defaultDomainName.
    </p>


    <form id="f" class="form" autocomplete="off">
      <input id="sub" type="text" inputmode="text" spellcheck="false"
        placeholder="00000000-0000-0000-0000-000000000000"
        required pattern="^[0-9a-fA-F-]{36}$" aria-label="Azure Subscription ID"/>
      <div class="btn-row">
        <button id="btnLookup" type="submit">Lookup</button>
        <div id="spin" class="spinner" aria-hidden="true"></div>
        <button id="btnClear" type="button" class="secondary">Clear</button>
      </div>
    </form>

    <div id="status" class="status"></div>

    <div id="out" class="grid" aria-live="polite"></div>
  </section>
</main>

<footer class="footer">
  <div>&copy; <span id="year"></span> <span style="font-weight:600">Bsure</span>. Internal use only.</div>
  <div><a href="#" id="copyLink">Copy app URL</a></div>
</footer>

<script>
const $ = s => document.querySelector(s);
const msg = (t, isErr) => { const el = $('#status'); el.textContent = t || ''; el.className = 'status' + (isErr ? ' err' : '') };

async function fetchMe(){
  try{
    const r = await fetch('/api/me');
    if(!r.ok) throw 0;
    const me = await r.json();
    const who = me.upn || me.name || 'signed in';
    document.getElementById('me').textContent = who;
  }catch{
    document.getElementById('me').textContent = 'signed in';
  }
}


document.addEventListener('DOMContentLoaded', () => {
  $('#year').textContent = new Date().getFullYear();
  fetchMe();

  $('#copyLink').addEventListener('click', (e)=>{
    e.preventDefault();
    navigator.clipboard?.writeText(location.href);
    msg('App URL copied to clipboard.');
    setTimeout(()=>msg(''), 1500);
  });

  $('#btnClear').addEventListener('click', ()=>{
    $('#sub').value=''; $('#out').innerHTML=''; msg('');
  });

  $('#f').addEventListener('submit', async ev=>{
    ev.preventDefault();
    const s = $('#sub').value.trim();
    $('#spin').classList.add('on');
    msg('Looking up…');
    $('#out').innerHTML = '';

    try {
      const r = await fetch(`/api/tenant?subscriptionId=${encodeURIComponent(s)}`);
      const txt = await r.text();
      if(!r.ok){
        try{ throw new Error(JSON.parse(txt).error) }catch{ throw new Error(txt || `HTTP ${r.status}`) }
      }
      const data = JSON.parse(txt);
      $('#out').innerHTML = `
        <div class="k">Tenant ID</div><div class="v">${data.tenantId || ''}</div>
        <div class="k">Display name</div><div class="v">${data.displayName || '(none)'}</div>
        <div class="k">Default domain</div><div class="v">${data.defaultDomainName || '(none)'}</div>
      `;
      msg(' ');
    } catch (e) {
      console.error(e);
      msg(e.message, true);
    } finally {
      $('#spin').classList.remove('on');
    }
  });
});
</script>
</body>
</html>