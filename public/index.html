<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Bsure Â· Tenant Lookup</title>
<link rel="icon" href="/logo.svg"/>
<link rel="stylesheet" href="/styles.css"/>
</head>
<body>

<header class="nav">
  <div class="nav-inner">
    <img src="/logo.svg" alt="Bsure logo" class="brand-logo"/>
    <div class="brand-title">Tenant lookup</div>
    <div id="me" class="chip" title="Signed-in user">signed in</div>
  </div>
</header>


<main class="wrap">
  <section class="card">
    <h1>Find tenant by Subscription ID</h1>
    <p class="lead">
      Enter a <b>Subscription ID</b>. The tool looks up tenantId, tenantName and defaultDomainName.
    </p>


    <form id="f" class="form" autocomplete="off">
      <input id="sub" type="text" inputmode="text" spellcheck="false"
        placeholder="00000000-0000-0000-0000-000000000000"
        required pattern="^[0-9a-fA-F-]{36}$" aria-label="Azure Subscription ID"/>
      <div class="btn-row">
        <button id="btnLookup" type="submit">Lookup</button>
        <div id="spin" class="spinner" aria-hidden="true"></div>
        <button id="btnClear" type="button" class="secondary">Clear</button>
      </div>
    </form>

    <div id="status" class="status"></div>

    <div id="out" class="grid" aria-live="polite"></div>
  </section>
</main>

<footer class="footer">
  <div>&copy; <span id="year"></span> <span style="font-weight:600">Bsure</span>. Internal use only.</div>
  <div><a href="#" id="copyLink">Copy app URL</a></div>
</footer>

<script>
const $ = s => document.querySelector(s);
const msg = (t, isErr) => { const el = $('#status'); el.textContent = t || ''; el.className = 'status' + (isErr ? ' err' : '') };

async function initUserChip() {
  const chip = document.getElementById('me');

  const setAsSignedOut = () => {
    chip.textContent = 'Sign in';
    chip.title = 'Sign in with Microsoft';
    chip.style.cursor = 'pointer';
    chip.onclick = () => {
      window.location.href = '/.auth/login/aad?post_login_redirect_uri=/&prompt=select_account';
    };
  };

  const setAsSignedIn = (who) => {
    chip.textContent = who || 'Signed in';
    chip.title = 'Signed-in user (click to sign out)';
    chip.style.cursor = 'pointer';
    chip.onclick = () => {
      window.location.href = '/.auth/logout?post_logout_redirect_uri=/';
    };
  };

  try {
    const r = await fetch('/api/me');
    if (!r.ok) throw new Error('Not signed in');

    const me = await r.json();
    const who = me.upn || me.name || 'Signed in';
    setAsSignedIn(who);
  } catch {
    setAsSignedOut();
  }
}

document.addEventListener('DOMContentLoaded', () => {
  $('#year').textContent = new Date().getFullYear();
  initUserChip();
  // ... keep the rest of your existing DOMContentLoaded code (form handlers etc.)
});
</script>

</body>
</html>